# Pratice by Егоров Александр
# 1. Установка CentOS на VMware
VMware Wokstation создает полностью изолированные безопасные виртуальные машины. Уровень виртуализации VVMware сопоставляет ресурсы физического оборудования с ресурсами виртуальной машины. Таким образом, каждая виртуальная машина получает собственные ЦП, память, диски и устройства ввода-вывода и является полным эквивалентом стандартного компьютера x86. Centos является дистрибутивом GNU/Linux, основанном на свободных исходных текстах коммерческого дистрибутива Red Hat Enterprise Linux компании Red Hat.

1) Скачиваем VMware и CentOS, CentOS можно найти на оффициальном сайте https://www.centos.org/

2) Установка VMware
![](http://i.imgur.com/rshRqtg.png)

3) Создание Виртуальной машины с помощью VMware
![](http://i.imgur.com/uyYJuNf.png)

4)В процессе установки выбираем логин и пароль для входа в систему, далее выделяем следующие ресурсы для CentOS:

![](http://i.imgur.com/p7MkqVX.png)

5) Завершаем установку виртуальной машины запускаем CentOs и авторизуемся с помощью ранее заданных логина и пароля

![](http://i.imgur.com/BU3RSWH.png)

# 2.1 Основные команды
Рассмотрим несколько основных команд, не зная которых было бы крайне сложно взаимодействовать с системой:

1) "su" данная команда наделяет правами суперпользователя и позволяет выполнять любые команды, для ее активации необходимо ввести пароль

![](http://i.imgur.com/Sbk3EP1.png)

2) Для смены каталога используется команда "cd". Если вы введете эту команду без аргументов, вы попадете в свой домашний каталог; чтобы попасть в любой другой каталог, необходимо указать путь к нему.

![](http://i.imgur.com/yyvj5uN.png)

3) Команда "ls" показывает список файлов текущей папки, с ключом -l показывает дополнительные сведения о файлах.
Вот что будет если использовать эту команду в директории /usr/bin

![](http://i.imgur.com/cQVS5Lt.png)

4) "vi" - открывает текстовый редактор

Вот описание некоторых команд:

![](http://i.imgur.com/Yb2onqw.png)

![](http://i.imgur.com/Ylxkfc8.png)

  "cp" - копирование файла
  
  cp file1 file2 сопировать файл file1 в файл file2
  
  cp dir/* . копировать все файлы директории dir в текущую директорию
  
  cp -a /tmp/dir1 . копировать директорию dir1 со всем содержимым в текущую директорию
  
  "cat" - показывает содержимое текстовых файлов, а также "cat" можно использовать для реализации следующих инструкций:
  
  cat /proc/cpuinfo -	отобразить информацию о процессоре
  
  cat /proc/interrupts -	показать прерывания
  
  cat /proc/meminfo -	проверить использование памяти
  
  cat /proc/swaps -	показать файл(ы) подкачки
  
  cat /proc/version -	вывести версию ядра
  
  cat /proc/net/dev -	показать сетевые интерфейсы и статистику по ним
  
  cat /proc/mounts -	отобразить смонтированные файловые системы
  
  ![](http://i.imgur.com/P3KCcu0.png)
  
# Права суперпользователя
  
  Активация команды "su" дает нам доступ к некоторым командам доступным только для "root"
  
  Например:
  
  1) "poweroff" - выключение компьютера
  
  2) "reboot" - перезагрузка системы
  
  3) "dir" - показывает список файлов в директории, отсортированных вертикально по столбцам, эквивалентно команде “ls –C –b”
  
  4) "mkdir" и "rmdir" - создать и удалить директорию соответственно
  
  ![](http://i.imgur.com/MBZEkEu.png)
  
# 2.2 Настройка сети
  используем команду "dhclient -v" для подключения к сети, а далее с помощью "ping 8.8.8.8" проверяем подключение
 
  ![](http://i.imgur.com/71IcGXp.png)
  
  ![](http://i.imgur.com/Kvu2d8U.png)

# 2.3 Установка ПО

  Установка дополнительного ПО производится с помощью плагина “yum” входящей в CentOS. Для установки необходимо быть пользователем “root”
  
  1) Текстовый редактор "nano"; для его установки необходимо ввести "yum install nano"
  
  ![](http://i.imgur.com/UWw7dVm.png)
  
  2) Браузер "elinks"; для его установки необходимо ввести "yum install elinks"
  
  ![](http://i.imgur.com/5KIFAfN.png)
 
  3) Файловй менеджер "mc" (midnight commander); для его установки необходимо ввести "yum install mc"
  
  ![](http://i.imgur.com/ZbZMv5c.png)
  
  А вот список "горячих клавиш":
  
  ![](http://i.imgur.com/2wwPssc.png)
  
# 3.1 SSH
  SSH (от англ. secure shell -- безопасная оболочка) это набор программ, которые позволяют регистрироваться на компьютере по сети, удаленно выполнять на нем команды, а также копировать и перемещать файлы между компьютерами. SSH организует защищенное безопасное соединение поверх небезопасных каналов связи.

SSH предоставляет замены традиционным r-командам удаленного доступа с тем отличием, что они обладают повышенной безопасностью. Они выполняются поверх защищенных зашифрованных соединений, которые не позволяет прослушивать или подменять трафик. Кроме того, SSH может обеспечивать безопасное соединение для передачи любого другого трафика: например, почтовых сообщений или файлов.

Чтобы получить доступ к серверу посредством протокола SSH необходимо программное обеспечение, которое обеспечит шифрование сеанса связи по сети. Именно таковым программным обеспечением и является оболочка OpenSSH которая является самой популярной из прочих программных продуктов на сегодняшний день.

# 3.2 Настройка SSH-сервера
 "yum -y install openssh-server openssh-clients" - С помощью данной команды мы производим установку серверной и клиентской части OpenSSH.
 
 "chkconfig sshd on" - Чтобы OpenSSH загружался автоматом, при загрузке системы, добавляем его в автозагрузку.
 
 "service sshd start" - Запуск OpenSSH
 
 "netstat -tulpn | grep :22" - Проверка порта по умолчанию
 
 ![](http://i.imgur.com/D4QhNZz.png)
 
 Настройка конфигурации OpenSSH:
 
 Конфигурационный файл OpenSSH называется sshd_config, и расположен по пути указанному ниже. Вся основная конфигурация OpenSSH производиться посредством этого файла. После того, как какие-либо изменения будут внесены в файл, следует перезапустить сервер, чтобы настройки вступили в силу.
 
 "vi /etc/ssh/sshd_config" - Файл конфигурации OpenSSH
 
 ![](http://i.imgur.com/AAm0yCM.png)
 
 Первый параметр – Port. По умолчанию используется 22 порт. Изменим его на нестандартный порт 2203 – это избавит наш сервер от сетевых роботов, которые автоматически сканируют интернет в поиске открытых портов и пытаются через них подключиться. 
 
"ListenAddress 0.0.0.0 "

 "ListenAddress : :"
 
Эти строки отвечают за настройку разграничений по сетевым интерфейсам, сетевому адресу или имени компьютера. По умолчанию сервер «слушает» (принимает подключения) на всех сетевых интерфейсах. 

Следующий параметр "Protocol" отвечает за версию протокола SSH. Значение по умолчанию 2. Его и оставляем. Не добавляем единичку ни при каких обстоятельствах. Первая версия протокола SSH не безопасна.

Строки HostKey необходимы для второй версии протокола SSH и отвечают за названия файлов ключей и их расположение. Первая строка отвечает за пару ключей RSA, вторая соответственно за пару ключей DSA. К названиям открытых (публичных) ключей добавляется .pub. Эти ключи используются при аутентификации с ключом хоста. Можно поменять слово host в названии ключей на имя нашего сервера, но мы сделаем это в части, посвященной генерации ключей. Сейчас же отключим ключи DSA, так как будем пользоваться только RSA:

 HostKey /etc/ssh/ssh_host_rsa_key

 # HostKey /etc/ssh/ssh_sunup_dsa_key

Следующие строки отвечают за временный ключ и его длину при работе с первой версией протокола SSH. Мы не используем SSH-1, поэтому пока закомментируем эти строки.

 # KeyRegenerationInterval 1h

 # ServerKeyBits 1024

Далее следует группа параметров, отвечающая за журналирование. События, связанные с доступом по SSH записываются в журнал /var/log/auth

Первый параметр определяет, список каких событий администратор хочет видеть в журнале. Доступны следующие значения: DAEMON, USER, AUTH, LOCAL0, LOCAL1, LOCAL2, LOCAL3, LOCAL4, LOCAL5, LOCAL6, LOCAL7. Нас интересует авторизация, поэтому оставляем AUTH.

SyslogFacility AUTH

Второй параметр определяет уровень детализации событий. Доступны следующие события: SILENT , QUIET, FATAL, ERROR, INFO, VERBOSE, DEBUG, DEBUG1, DEBUG2, DEBUG3. Оставляем уровень детализации по умолчанию, если возникнут ошибки, то всегда можно увеличить детализацию журнала.

LogLevel INFO

Следующая группа параметров относится к аутентификации. Первый параметр означает, что соединение будет разорвано через указанное количество секунд, если пользователь не войдёт в систему. Уменьшим это время в два раза.

LoginGraceTime 1m

Второй параметр разрешает или запрещает вход по SSH под суперпользователем.

PermitRootLogin yes

Третий параметр включает проверку демоном ssh прав и владение домашним каталогом пользователя, который пытается получить удалённый доступ к компьютеру. Оставляем yes.

StrictModes yes

Добавляем параметр AllowUsers, которого нет в конфигурационном файле по умолчанию. Этот параметр разрешает доступ к серверу по протоколу SSH только для перечисленных пользователей.

AllowUsers admin

разрешение есть только у пользователя admin. Значениями этого параметра могут выступать имена пользователей, отделённые друг от друга пробелами. Нельзя использовать в качестве значений UID (User ID). Можно использовать запись пользователя в виде user@host, например. Это означает, что доступ разрешён пользователю admin с компьютера echidna. Причём пользователь и компьютер проверяются отдельно, это позволяет разграничить доступ определенных пользователей с определенных компьютеров. Существует обратный параметр – DenyUsers, который запрещает доступ пользователям, перечисленным в значении этого параметра. Кроме параметров связанных с доступом отдельных пользователей существуют соответствующие параметры для групп: AllowGroups и DenyGroups.

Группу из четырёх параметров, отвечающих за аутентификацию Kerberos, оставляем без изменений – не раскомментированными.

 #KerberosAuthentication no

 #KerberosGetAFSToken no

 #KerberosOrLocalPasswd yes

 #KerberosTicketCleanup yes

Следующие два закомментированных параметра отвечают за то, разрешена ли аутентификация пользователя на основе GSSAPI или нет.

 #GSSAPIAuthentication no

 #GSSAPICleanupCredentials yes
 
 ![](http://i.imgur.com/RZaNyFR.png)

# 3.3 Подключение с одной ВМ на другую

Создаем вторую виртуальную машину, настройку проводим аналогично первой

Узнаем ip первой машины с помощью команды "ip a"

теперь с помощью второй системы соединяемся первой машиной с помощью команды: 

ssh name@ip

![](http://i.imgur.com/4p3HSxj.png)

# 3.4 Putty

Скачиваем утилиту putty с оффициального сайта, запускаем её, вводим ip виртуальной машины, на которую мы хотим зайти

при установке putty, в архиве будет находится файл pscp.exe, его надо запустить через командную строку windows

![](http://i.imgur.com/TbQ3Ov3.png)

![](http://i.imgur.com/CTnvaiH.png)

В результате этого логинимся и получаем доступ к ВМ!

если мы хотим скопировать файл с реальной машины на виртуальную, пользуемся командой 

pscp С:\\адресс файла (пробел) host_name@host_ip:/folder

для копирования же файла с ВМ просто пишем pscp host_name@host_ip:/folder 

# 3.5 SSH-ключи

Ключи SSH служат средством идентификации вас при подключении к серверу SSH с использованием криптосистемы с открытым ключом и аутентификации вызов-ответ. Одним из непосредственных достоинств этого метода перед традиционной идентификацией с помощью пароля является то, что вы можете быть авторизованы на сервере без регулярной необходимости отсылать ваш пароль через сеть. Даже если кто-либо будет прослушивать ваше соединение, у него не будет возможности перехватить и взломать ваш пароль, поскольку фактически он никогда не передается. Также использование для идентификации ключей SSH устраняет риск, связанный с брут-форс (brute-force) атаками, за счет существенного уменьшения шанса атакующего угадать правильные учетные данные.
Идентификация при помощи ключей SSH предоставляет дополнительную безопасность, а также может быть более удобным способом, чем традиционная идентификация при помощи пароля. При использовании вместе с программой, называемой агентом SSH, ключи SSH могут подключать вас к серверу или нескольким серверам без необходимости помнить и вводить ваш пароль отдельно для каждой системы.

Ключи SSH являются парными: один из них - закрытый, другой - открытый. Закрытый ключ известен только вам, и он должен быть в безопасности. С другой стороны, открытый ключ может свободно раздаваться с любого сервера SSH, к которому вы хотите подключиться.
Когда у сервера SSH есть ваш открытый ключ в файле, и он видит, что вы запрашиваете соединение, он использует этот открытый ключ, чтобы создать и отправить вам т.н. вызов. Этот вызов является чем-то вроде зашифрованного сообщения, на которое должен поступить соответствующий ответ, чтобы сервер предоставил вам доступ. Безопасным это сообщение делает тот факт, что оно может быть прочитано только кем-то, у кого есть закрытый ключ. Открытый ключ может быть использован для зашифровки сообщения, но расшифровать то же самое сообщение он не сможет. Только вы, держатель закрытого ключа, будете иметь возможность корректно принять вызов и создать соответствующий ответ.
Этот этап вызов-ответ проходит незаметно для пользователя. До тех пор, пока у вас есть закрытый ключ, который обычно хранится в каталоге ~/.ssh/, ваш клиент SSH будет иметь возможность отправить правильный ответ серверу.
Поскольку закрытые ключи считаются конфиденциальной информацией, обычно они хранятся на диске в зашифрованном виде. По этой причине, когда запрашивается закрытый ключ, необходимо ввести пароль для расшифровки этого ключа. Внешне это может быть похоже на ввод пароля непосредственно на сервере SSH, но это не так: этот пароль используется только для расшифровки закрытого ключа в вашей локальной системе. Этот пароль не передается и не должен передаваться через сеть.

Для создания ключа вам необходимо ввести в консоли команду:

"ssh-keygen -t rsa"

![](http://i.imgur.com/0QECsor.png)

Далее везде нажимаем Enter, пропуская дополнительные вопросы о сохранении ключа в определенную папку и идентификационное слово.

Теперь ваши открытый и закрытый SSH-ключи должны быть сгенерированы. Откройте файловый менеджер и перейдите в директорию 

.ssh. Вы должны увидеть два файла: id_rsa и id_rsa.pub.

 Загрузите файл id_rsa.pub в домашнюю директорию вашего удаленного хоста (предполагается, что удаленный хост работает под Linux). Подключитесь к удаленному хосту с помощью SSH и переместите открытый ключ в его целевую директорию с помощью команд:

$ cat id_rsa.pub >> ~/.ssh/authorized_keys

$ rm id_rsa.pub

Убедитесь, что следующие атрибуты имеют корректные значения:

RSAAuthentication yes

PubkeyAuthentication yes 

PasswordAuthentication no

Теперь вы можете соединяться со своим удаленным хостом с помощью команды:

ssh -i /path-to-private-key admin@198.168.95.129

#3.6 FTP

FTP (англ. File Transfer Protocol — протокол передачи файлов) — стандартный протокол, предназначенный для передачи файлов по TCP-сетям (например, Интернет). Использует 21й порт. FTP часто используется для загрузки сетевых страниц и других документов с частного устройства разработки на открытые сервера хостинга.

Протокол построен на архитектуре «клиент-сервер» и использует разные сетевые соединения для передачи команд и данных между клиентом и сервером. Пользователи FTP могут пройти аутентификацию, передавая логин и парольоткрытым текстом, или же, если это разрешено на сервере, они могут подключиться анонимно. Можно использовать протокол SSH для безопасной передачи, скрывающей (шифрующей) логин и пароль, а также шифрующей содержимое.

Первые клиентские FTP-приложения были интерактивными инструментами командной строки, реализующими стандартные команды и синтаксис. Графические пользовательские интерфейсы с тех пор были разработаны для многих используемых по сей день операционных систем. Среди этих интерфейсов как программы общего веб-дизайна вроде Microsoft Expression Web, так и специализированные FTP-клиенты (например, FileZilla).
FTP является одним из старейших прикладных протоколов, появившимся задолго до HTTP, и даже до TCP/IP, в 1971 году. В первое время он работал поверх протокола NCP[1]. Он и сегодня широко используется для распространения ПО и доступа к удалённым хостам.

Доступ к файлам на удаленном компьютере по протоколу FTP осуществляется с помощью программ, которые называются FTP-клиентами (в качестве примитивного FTP-клиента может использоваться www-браузер, например Opera, Firefox или Microsoft Internet Explorer). Практически все современные операционные системы включают также FTP-клиент для работы в командной строке, который так и называется «ftp».

Если у вас есть интернет, то вы можете получить доступ к большому количеству информации, расположенной в различных уголках Сети. Для использования FTP необходим так называемый FTP-клиент, подключающийся к FTP-серверу (сервер, откуда скачиваются данные).Анонимный FTP позволяет подключаться к серверу даже не будучи на нем зарегистрированным (не имея на нем логина и пароля). Как правило, в качестве логина (имени пользователя) указывается anonymous, а в качестве пароля — ваш e-mail. Это делается на больших серверах для того, чтобы каждый мог скачать, к примеру, бесплатный дистрибутив Linux или какие-нибудь другие полезные программы.

FTP-клиент общается с FTP-сервером при помощи специальных FTP-команд (в зависимости от сервера они могут незначительно отличаться, но в целом набор команд более-менее стандартен). Тогда почему бы не дать возможность пользователю вводить эти команды, чтобы без посредника просматривать содержимое FTP-сервера, закачивать файлы, устанавливать режимы передачи. 

FTP сервер vsftpd (Very Secure FTP daemon) является одним из надежнейших и простых в настройке ftp серверов. Это оптимальный выбор для большинства пользователей, которым нужен ftp сервер.

"yum install vsftpd" - Установка vsftpd. Этот пакет входит в стандартный репозитарий CentOS, поэтому проблем с установкой возикнуть не должно.

![](http://i.imgur.com/qWRvYFM.png)

"chkconfig vsftpd on" - Добавим запуск сервера при старте системы

далее открываем конфигурационный файл /etc/vsftpd/vsftpd.conf по этому адресу

и поменяем настройки:

![](http://i.imgur.com/PaLZfpR.png)

![](http://i.imgur.com/XvEifEo.png)

Далее добавляем нового пользователя:

"useradd FTPuser" (где FTPuser - ваш пользователь для FTP)

Задаем пароль для этого пользователя  "passwd FTPuser" (вводим пароль)

скачиваем еще одну утилиту "yum intstall ftp"

далее после установки вводим "ftp localhost"

![](http://i.imgur.com/x32hYx1.png)

Готово!



